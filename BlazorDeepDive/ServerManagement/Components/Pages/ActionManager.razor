@page "/action"
@rendermode InteractiveServer
@using ServerManagement.Models
@using ServerManagement.Components.Controls
@using Microsoft.FluentUI.AspNetCore.Components
@inject IToastService ToastService

<h3>Actions</h3>

<EntityManager TItem="ActionModel"
               Items="@Actions"
               ConfigMapping="@ActionConfigMapping"
               CreateDefault="@CreateDefaultAction"
               OnApply="@OnApply"
               OnCancel="@OnCancel" />

@code {
    private List<ActionModel> Actions { get; set; } = new();

    private readonly Dictionary<Type, Type> ActionConfigMapping = new()
    {
        { typeof(LisOrderActionModel), typeof(ActionConfig) },
        { typeof(InstrumentResultActionModel), typeof(ActionConfig) },
        { typeof(EmptyAction), typeof(ActionConfig) }
    };

    protected override void OnInitialized()
    {
        if (Actions.Count == 0)
        {
            Actions.Add(CreateDefaultAction());
        }
    }

    private ActionModel CreateDefaultAction()
    {
        return new EmptyAction();
    }

    private async Task OnApply(List<ActionModel> actions)
    {
        bool allValid = actions.All(a => a != null);

        if (allValid)
        {
            ToastService.ShowSuccess("All actions are valid!");
        }
        await Task.CompletedTask;
    }

    private async Task OnCancel()
    {
        Actions.Clear();
        Actions.Add(CreateDefaultAction());
        await Task.CompletedTask;
    }
}